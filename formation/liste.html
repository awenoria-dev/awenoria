<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title id="head-title">Catalogue des formations – Awenoria</title>
  <meta name="description" content="Catalogue filtrable par thématique ou par public. Fiches détaillées, formats flexibles, supports & attestation inclus." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:opsz,wght@12..96,300..800&display=swap" rel="stylesheet">
  <style>
    :root{
      --font:"Manrope",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      --bg:#f6f9fc; --panel:#fff; --muted:#4a6176; --text:#0f5f9a;
      --brand:#0f5f9a; --copper:#ff8a3d; --shadow:0 12px 28px rgba(0,0,0,.08);
      --maxw:1200px
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0; color:var(--text); font-family:var(--font);
      background:
        radial-gradient(1400px 700px at 10% -20%, #eef6ff 0%, rgba(238,246,255,.6) 45%, transparent 60%),
        linear-gradient(180deg,#fff 0%,#f6f9fc 100%);
      -webkit-font-smoothing:antialiased
    }
    a{color:inherit; text-decoration:none} a:hover{text-decoration:underline}
    header{position:sticky; top:0; z-index:10; background:rgba(255,255,255,.85);
      backdrop-filter:blur(10px); border-bottom:1px solid rgba(15,23,32,.08)}
    .nav{max-width:var(--maxw); margin:0 auto; padding:10px 16px; display:flex; align-items:center; gap:16px}
    .nav img{height: clamp(56px,8vw,96px); display:block}

    .wrap{max-width:var(--maxw); margin:28px auto; padding:0 20px}
    .crumbs{color:#456; font-weight:700; margin-bottom:8px}

    /* === HERO catalogue (style PJ2) === */
    .title-center{font-weight:800; font-size:clamp(28px,5vw,52px); text-align:center; margin:10px 0 6px}
    .subtitle-center{color:var(--muted); text-align:center; margin:0 0 8px}
    .underline{width:84px; height:4px; border-radius:999px; background:var(--copper);
      margin:12px auto 18px; opacity:.95}
    .cta-row{display:flex; gap:16px; justify-content:center; flex-wrap:wrap; margin:18px 0 6px}
    .btn{display:inline-flex; align-items:center; justify-content:center; font-weight:800;
      border-radius:9999px; padding:12px 20px; border:1px solid transparent;
      background:rgba(27,136,255,.80); color:#fff; text-decoration:none}
    .btn.secondary{background:rgba(27,136,255,.80)}
    .btn:hover{background:rgba(27,136,255,.9)}

    /* Filtres rapides (affichés seulement quand filtré) */
    .filters{display:flex; flex-wrap:wrap; gap:8px; margin:12px 0 18px; justify-content:center}
    .pill{display:inline-flex; align-items:center; gap:6px; border:1px solid rgba(15,23,32,.16);
      border-radius:999px; padding:8px 12px; background:#fff; font-weight:800}
    .pill[aria-pressed="true"]{background:rgba(27,136,255,.10); border-color:rgba(27,136,255,.35)}

    /* Cartes */
    .grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(320px,1fr)); gap:20px}
    .card{background:rgba(255,255,255,.86); border:1px solid rgba(15,23,32,.08);
      border-radius:22px; padding:20px; box-shadow:var(--shadow)}
    .card h3{margin:0 0 8px; font-weight:800}
    .meta{display:flex; flex-wrap:wrap; gap:8px; margin:8px 0}
    .tag{border:1px solid rgba(15,23,32,.12); border-radius:999px; padding:6px 10px;
      font-size:12px; font-weight:800; background:rgba(27,136,255,.06)}
  </style>
</head>
<body>
<header>
  <div class="nav">
    <a href="/index.html" aria-label="Aller à l’accueil"><img src="/images/logo.png" alt="Awenoria"></a>
  </div>
</header>

<main class="wrap">
  <nav class="crumbs" aria-label="Fil d'Ariane">
    <a href="/formation/index.html">Nos formations</a> › <span id="crumb">Catalogue</span>
  </nav>

  <!-- HERO centré -->
  <h1 id="page-title" class="title-center">Catalogue</h1>
  <p id="page-sub" class="subtitle-center">Filtrez par thématique ou par public, puis ouvrez la fiche détaillée.</p>
  <div class="underline"></div>

  <!-- CTAs façon PJ2 -->
  <div class="cta-row" id="cta-row">
    <a class="btn secondary" href="/formation/themes/">Par thématique</a>
    <a class="btn secondary" href="/formation/publics/">Par public</a>
    <a class="btn" href="/index.html#contact">Demander un programme</a>
  </div>

  <!-- Filtres rapides (cachés par défaut, visibles quand un filtre est actif) -->
  <div class="filters" id="quick-filters" aria-label="Filtres rapides" style="display:none"></div>

  <!-- Cartes -->
  <section id="cards" class="grid" aria-live="polite"></section>
</main>

<noscript><div class="wrap"><p>Activez JavaScript pour voir le catalogue.</p></div></noscript>

<script type="module">
  import { COURSES } from "../js/courses-data.js";

  const THEME_LABELS = {
    "rgpd-essentiels":"RGPD – essentiels, registre, AIPD",
    "ia-act":"IA Act – obligations & documentation",
    "cookies":"Cookies & CMP",
    "web-legal":"Mentions légales & conformité web",
    "access":"Accessibilité (RGAA / EN 301 549)",
    "cyber":"Cybersécurité de base"
  };
  const AUDIENCE_LABELS = {
    dirigeants:"Dirigeants & responsables",
    equipes:"Équipes opérationnelles",
    dpo:"Référents / DPO",
    dev:"Dev, Produit & Data"
  };

  const params = new URLSearchParams(location.search);
  let theme = params.get("theme");
  let audience = params.get("public");

  // titres / crumb
  const title = document.getElementById("page-title");
  const sub   = document.getElementById("page-sub");
  const crumb = document.getElementById("crumb");
  const quick = document.getElementById("quick-filters");
  const cta   = document.getElementById("cta-row");

  function updateHead(){
    if (theme){
      title.textContent = THEME_LABELS[theme] || "Thématique";
      sub.textContent   = "Formations liées à cette thématique.";
      crumb.textContent = title.textContent;
      document.title    = `${title.textContent} – Catalogue – Awenoria`;
      quick.style.display = "";   // montrer les puces
      cta.style.display   = "none"; // masquer les 3 boutons
    } else if (audience){
      title.textContent = AUDIENCE_LABELS[audience] || "Public";
      sub.textContent   = "Formations recommandées pour ce public.";
      crumb.textContent = title.textContent;
      document.title    = `${title.textContent} – Catalogue – Awenoria`;
      quick.style.display = "";
      cta.style.display   = "none";
    } else {
      title.textContent = "Catalogue";
      sub.textContent   = "Filtrez par thématique ou par public, puis ouvrez la fiche détaillée.";
      crumb.textContent = "Catalogue";
      document.title    = "Catalogue des formations – Awenoria";
      quick.style.display = "none"; // on garde l’UI épurée comme ta PJ2
      cta.style.display   = "";     // montrer les 3 boutons
    }
  }
  updateHead();

  // Puces rapides (affichées uniquement si filtré)
  function pill(label, href, pressed=false){
    const a = document.createElement("a");
    a.className="pill"; a.setAttribute("aria-pressed", pressed?"true":"false");
    a.textContent = label; a.href = href; return a;
  }
  function buildQuickFilters(){
    quick.innerHTML = "";
    if (!theme && !audience) return; // pas de puces en mode catalogue global (PJ2)
    Object.entries(THEME_LABELS).forEach(([k,v]) =>
      quick.appendChild(pill(v, `./liste.html?theme=${encodeURIComponent(k)}`, theme===k)));
    const sep = document.createElement("span"); sep.style.margin="0 4px"; sep.textContent="•"; quick.appendChild(sep);
    Object.entries(AUDIENCE_LABELS).forEach(([k,v]) =>
      quick.appendChild(pill(v, `./liste.html?public=${encodeURIComponent(k)}`, audience===k)));
    const sep2 = document.createElement("span"); sep2.style.margin="0 4px"; sep2.textContent="•"; quick.appendChild(sep2);
    quick.appendChild(pill("Tout le catalogue", "./liste.html", (!theme && !audience)));
  }
  buildQuickFilters();

  // Filtrage
  let list = COURSES.slice();
  if (theme)    list = list.filter(c => (c.themes||[]).includes(theme));
  if (audience) list = list.filter(c => (c.audiences||[]).includes(audience));

  // Rendu des cartes
  const cards = document.getElementById("cards");
  const tag = (t) => `<span class="tag">${t}</span>`;
  function render(){
    if (!list.length){
      cards.innerHTML = `<p style="text-align:center;color:#4a6176">Aucune formation trouvée.</p>`;
      return;
    }
    const ctx = theme ? `from=theme&theme=${encodeURIComponent(theme)}` :
                audience ? `from=public&public=${encodeURIComponent(audience)}` :
                `from=catalogue`;
    cards.innerHTML = list.map(c => `
      <article class="card">
        <h3>${c.title}</h3>
        <div class="meta">
          ${c.duration ? tag(c.duration):""}
          ${c.level ? tag(c.level):""}
          ${(c.modalities||[]).map(tag).join("")}
        </div>
        <p>${c.summary||""}</p>
        <p style="margin-top:8px">
          <a class="btn" href="/formation/fiches/${c.slug}.html?${ctx}" aria-label="Voir ${c.title}">Voir la fiche</a>
        </p>
      </article>
    `).join("");
  }
  render();
</script>
</body>
</html>
