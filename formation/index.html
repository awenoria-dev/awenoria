<script src="../js/courses-data.js"></script>
<script>
  const root = document.getElementById("cards");
  if (!window.COURSES?.length) {
    root.innerHTML = "<p>Aucune formation disponible.</p>";
  } else {
    root.innerHTML = COURSES.map(c => `
      <article class="card">
        <h3>${c.title}</h3>
        <div class="meta">
          ${c.duration ? `<span class="tag">${c.duration}</span>` : ""}
          ${c.level ? `<span class="tag">${c.level}</span>` : ""}
          ${(c.modalities || []).map(m => `<span class="tag">${m}</span>`).join("")}
        </div>
        <p>${c.summary || ""}</p>
        <p style="margin-top:8px">
          <a class="btn primary" href="./${c.slug}.html?from=catalogue"
             aria-label="Voir la fiche détaillée de ${c.title}">Voir la fiche</a>
        </p>
      </article>
    `).join("");

    // animation d’apparition (préférence utilisateur respectée)
    const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    if (!prefersReduced) {
      const cards = document.querySelectorAll('#cards .card');
      const io = new IntersectionObserver((entries, obs) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const index = [...entry.target.parentElement.children].indexOf(entry.target);
            entry.target.style.transitionDelay = `${Math.min(index * 80, 400)}ms`;
            entry.target.classList.add('reveal');
            obs.unobserve(entry.target);
          }
        });
      }, { threshold: 0.12 });
      cards.forEach(card => io.observe(card));
    }
  }
</script>
