<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Politique cookies — Awenoria</title>
  <meta name="description" content="Politique relative aux cookies et autres traceurs utilisés sur le site Awenoria : finalités, bases légales, durées, partenaires, et gestion de vos préférences.">
  <link rel="icon" type="image/png" sizes="32x32" href="./images/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="./images/favicon-16.png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <!-- CSS globale -->
  <link rel="stylesheet" href="assets/awenoria.css">

  <style>
    :root{
      --aw-ink:#0a0a0a; --aw-blue:#0066ff; --aw-copper:#ff5c00; --aw-muted:#6b7280;
      --aw-panel:#ffffff; --aw-bg:#f5f7ff; --aw-radius:24px;
      --shadow:0 25px 50px -12px rgba(0,0,0,.15);
      --transition:.6s cubic-bezier(.22,1,.36,1);
    }
    @media (prefers-color-scheme:dark){
      :root{
        --aw-ink:#f5f7ff; --aw-blue:#3d8bff; --aw-copper:#ff8a3d; --aw-muted:#a1a9c0;
        --aw-panel:#0b0f1a; --aw-bg:#0a0d14; --shadow:0 25px 50px -12px rgba(0,0,0,.45);
      }
    }
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    html{scroll-behavior:smooth}
    body{font-family:"Inter",system-ui,-apple-system,Arial,sans-serif;line-height:1.7;color:var(--aw-ink);background:var(--aw-bg);-webkit-font-smoothing:antialiased;}
    a{text-decoration:none;color:var(--aw-blue)}
    img{max-width:100%;display:block}
    .container{max-width:1200px;margin:0 auto;padding:0 20px}

    /* ---------- Hero (identique aux autres pages) ---------- */
    .hero{
      position:relative; min-height:60vh; min-height:60svh;
      display:flex; align-items:center; justify-content:center;
      text-align:center; color:#fff; overflow:hidden;
      background:
        radial-gradient(140% 150% at 10% -20%, rgba(255,255,255,.15), transparent 60%),
        radial-gradient(120% 120% at 120% 10%, rgba(255,255,255,.10), transparent 60%),
        linear-gradient(180deg, #0033cc 0%, #0066ff 100%);
    }
    .hero canvas{position:absolute; inset:0; width:100%; height:100%; z-index:0;}
    .hero .content{position:relative; z-index:2; max-width:920px; padding:0 20px; animation:fadeInUp 1s both;}
    .hero h1{font-size:clamp(48px,6.5vw,72px); font-weight:800; line-height:1.05; letter-spacing:-.02em;}
    .hero .lead{font-size:1.25rem; font-weight:500; margin:18px auto 0; color:#e8f0ff;}

    /* ---------- Sections & cartes ---------- */
    .section{max-width:1200px; margin:0 auto; padding:100px 20px;}
    .section.alt{background:var(--aw-bg);}
    .title{
      margin:0 0 10px; text-align:center; font-size:clamp(30px,4.5vw,42px);
      color:var(--aw-ink); font-weight:800;
    }
    .title::after{content:''; display:block; width:60px; height:4px; background:var(--aw-copper); margin:10px auto 0; border-radius:3px;}
    .grid{display:grid; gap:24px}
    .cols-2{grid-template-columns:repeat(2,1fr)}
    @media(max-width:980px){.cols-2{grid-template-columns:1fr}}

    .card{
      background:var(--aw-panel); border:1px solid rgba(15,23,32,.08);
      border-radius:var(--aw-radius); box-shadow:var(--shadow);
      padding:24px; transition:all var(--transition);
    }
    .card:hover{transform:translateY(-2px)}
    .muted{color:var(--aw-muted)}
    .pill{
      display:inline-flex; align-items:center; justify-content:center;
      padding:6px 12px; border-radius:999px; background:var(--aw-blue);
      color:#fff; font:800 12px/1 "Inter",system-ui,-apple-system,Arial,sans-serif;
    }
    .btn{
      display:inline-block; padding:10px 14px; border-radius:10px; font-weight:800;
      color:#fff; background:var(--aw-blue); box-shadow:var(--shadow); font-size:14px; transition:all var(--transition);
    }
    .btn:hover{background:var(--aw-copper); transform:translateY(-2px);}
    .btn.ghost{background:var(--aw-panel); color:var(--aw-blue); border:1px solid rgba(15,23,32,.08);}
    .btn-row{display:flex;gap:10px;flex-wrap:wrap}

    .table{width:100%;border-collapse:separate;border-spacing:0;background:var(--aw-panel);
      border:1px solid rgba(15,23,32,.08);border-radius:12px;overflow:hidden}
    .table th,.table td{padding:12px 14px;border-bottom:1px solid rgba(15,23,32,.08);vertical-align:top}
    .table th{background:#f6fbff;text-align:left;font-weight:800;color:#0f2746}
    .table tr:last-child td{border-bottom:none}

    .note{font-size:13px;color:var(--aw-muted)}
    .kblock{display:flex;gap:16px;align-items:flex-start}
    .kblock .icon{flex:0 0 auto;width:42px;height:42px;border-radius:10px;background:linear-gradient(180deg,#eaf5fd,#d8ecfa);display:grid;place-items:center;border:1px solid #cbe3f3}

    /* Anim */
    @keyframes fadeInUp{from{opacity:0;transform:translateY(30px)} to{opacity:1;transform:none}}
  </style>
</head>
<body class="page-cookies">

  <!-- Header injecté -->
  <div id="header"></div>

  <!-- HERO bleu + particules -->
  <section class="hero">
    <canvas id="canvas" aria-hidden="true"></canvas>
    <div class="content">
      <h1>Politique cookies</h1>
      <p class="lead">Tout savoir sur les cookies et autres traceurs utilisés sur ce site, et <b>gérer vos préférences</b>.</p>
    </div>
  </section>

  <main>
    <!-- Intro + bases légales -->
    <section class="section">
      <div class="container">
        <div class="grid cols-2">
          <article class="card">
            <h2>Qu’est-ce qu’un cookie&nbsp;?</h2>
            <p>Un «&nbsp;cookie&nbsp;» est un petit fichier texte déposé sur votre terminal (ordinateur, mobile, tablette) lors de la visite d’un site. D’autres traceurs peuvent être utilisés (local storage, pixels, SDK, etc.). Ils permettent, par exemple, de mémoriser vos préférences, de mesurer l’audience ou de personnaliser les contenus.</p>
            <p>Le dépôt/lecture de traceurs non strictement nécessaires requiert votre <b>consentement</b>. Vous pouvez le <a href="#prefs">modifier à tout moment</a>.</p>
          </article>

          <article class="card">
            <h2>Bases légales & durée</h2>
            <ul>
              <li><b>Strictement nécessaires</b> : intérêt légitime (exemption consentement), durée limitée au fonctionnement.</li>
              <li><b>Mesure d’audience</b> : <span class="muted">consentement</span> (ou exemption si configuration conforme — voir ci-dessous).</li>
              <li><b>Fonctionnalités & personnalisation</b> : <b>consentement</b>.</li>
              <li><b>Publicité & réseaux sociaux</b> : <b>consentement</b>.</li>
            </ul>
            <p>Le détail des durées de conservation figure dans le tableau ci-dessous.</p>
          </article>
        </div>
      </div>
    </section>

    <!-- Tableau des traceurs -->
    <section class="section alt">
      <div class="container">
        <h2 class="title">Liste des traceurs</h2>
        <p class="muted" style="text-align:center;margin-top:6px">Complétez ce tableau avec vos propres traceurs. Supprime ou ajoute des lignes si nécessaire.</p>

        <div class="card" style="margin-top:18px">
          <table class="table" aria-describedby="tbl-desc">
            <caption id="tbl-desc" class="muted" style="caption-side:bottom;padding:10px 0 0">Dernière mise à jour : [[JJ/MM/AAAA]]</caption>
            <thead>
              <tr>
                <th>Catégorie</th>
                <th>Nom</th>
                <th>Finalité</th>
                <th>Durée</th>
                <th>Fournisseur</th>
                <th>Transfert hors UE</th>
              </tr>
            </thead>
            <tbody>
              <!-- Nécessaires -->
              <tr>
                <td><b>Nécessaires</b></td>
                <td>[[awenoria_session]]</td>
                <td>Maintenir la session utilisateur et la sécurité.</td>
                <td>Session</td>
                <td>Awenoria (éditeur)</td>
                <td>Non</td>
              </tr>
              <tr>
                <td><b>Nécessaires</b></td>
                <td>[[consent_state]]</td>
                <td>Enregistrer vos choix de consentement.</td>
                <td>6 mois</td>
                <td>Awenoria (éditeur)</td>
                <td>Non</td>
              </tr>

              <!-- Mesure d'audience -->
              <tr>
                <td><b>Mesure d’audience</b></td>
                <td>[[matomo_*]] / [[plausible_*]] / [[ga_*]]</td>
                <td>Mesurer la fréquentation et les performances du site.</td>
                <td>[[13 mois]]</td>
                <td>[[Matomo|Plausible|Google Analytics]]</td>
                <td>[[Oui/Non — précisez pays & garanties]]</td>
              </tr>

              <!-- Fonctionnalités -->
              <tr>
                <td><b>Fonctionnalités</b></td>
                <td>[[intercom_*]] / [[hotjar_*]]</td>
                <td>Améliorer l’expérience (chat, feedback, cartes de chaleur conformes).</td>
                <td>[[6 mois]]</td>
                <td>[[Fournisseur]]</td>
                <td>[[Oui/Non]]</td>
              </tr>

              <!-- Publicité -->
              <tr>
                <td><b>Publicité</b></td>
                <td>[[fbp]] / [[fbc]] / [[_gcl_au]]</td>
                <td>Mesurer et optimiser les campagnes publicitaires.</td>
                <td>[[90 jours]]</td>
                <td>[[Meta|Google|…]]</td>
                <td>[[Oui/Non]]</td>
              </tr>
            </tbody>
          </table>

          <p class="note" style="margin-top:12px">
            <b>Exemption mesure d’audience :</b> certains outils (ex. Matomo, AT Internet) peuvent être exemptés de consentement si strictement limités (IP tronquée, pas de recoupement, durée courte, opt-out, respect du DNT, etc.). Si vous êtes dans ce cas, précisez-le ici et configurez l’outil en conséquence.
          </p>
        </div>
      </div>
    </section>

    <!-- Préférences / CMP -->
    <section id="prefs" class="section">
      <div class="container">
        <h2 class="title">Gérer vos préférences</h2>
        <div class="grid cols-2" style="margin-top:18px">
          <article class="card">
            <div class="kblock">
              <div class="icon" aria-hidden="true">⚙️</div>
              <div>
                <h3 style="margin:0 0 6px">Centre de préférences</h3>
                <p>Vous pouvez modifier vos choix à tout moment&nbsp;:</p>
                <div class="btn-row" role="group" aria-label="Actions de consentement">
                  <button class="btn" data-consent="accept_all">Tout accepter</button>
                  <button class="btn ghost" data-consent="refuse_all">Tout refuser</button>
                  <button class="btn" data-consent="customize">Personnaliser</button>
                </div>
                <p class="note" style="margin-top:10px">Ces boutons appellent votre CMP si elle est présente (<code>__tcfapi</code>, <code>__cmp</code>, etc.). À défaut, un mécanisme local minimal est appliqué (aucun traceur non-essentiel par défaut).</p>
              </div>
            </div>
          </article>

          <article class="card">
            <h3 style="margin-top:0">Signal “Do Not Track” et retrait</h3>
            <p>Si votre navigateur envoie le signal «&nbsp;Do Not Track&nbsp;», nous nous efforçons de le respecter lorsque c’est techniquement possible. Vous pouvez également supprimer manuellement les cookies via les paramètres de votre navigateur.</p>
            <ul class="note">
              <li>Chrome/Edge : Paramètres ▶ Confidentialité et sécurité ▶ Cookies et autres données</li>
              <li>Firefox : Paramètres ▶ Vie privée et sécurité ▶ Cookies et données de sites</li>
              <li>Safari : Réglages ▶ Safari ▶ Avancé ▶ Données de sites web</li>
            </ul>
          </article>
        </div>
      </div>
    </section>

    <!-- Responsable & contact -->
    <section class="section alt">
      <div class="container">
        <div class="card">
          <h2>Responsable & contact</h2>
          <p>Le responsable du site est <b>[[Dénomination sociale]]</b>, [[forme juridique]] au capital de [[capital social]] €, immatriculée au RCS de [[Ville]] sous le n° [[SIREN]], siège social [[Adresse complète]].</p>
          <p>Pour toute question sur cette politique ou l’exercice de vos droits, écrivez à <a href="mailto:[[vosdroits@votredomaine.fr]]">[[vosdroits@votredomaine.fr]]</a>.</p>
          <p class="note">Dernière mise à jour : [[JJ/MM/AAAA]]</p>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer injecté -->
  <div id="footer"></div>

  <!-- ===== JS : canvas hero (particules) ===== -->
  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let w = canvas.width = innerWidth;
    let h = canvas.height = innerHeight;
    const particles = [];
    const opts = {count:60,speed:.3,radius:2,distance:120,color:'rgba(255,255,255,.25)'};

    addEventListener('resize', () => { w = canvas.width = innerWidth; h = canvas.height = innerHeight; });

    class Particle{
      constructor(){ this.x=Math.random()*w; this.y=Math.random()*h; this.vx=(Math.random()-.5)*opts.speed; this.vy=(Math.random()-.5)*opts.speed; }
      update(){ this.x+=this.vx; this.y+=this.vy; if(this.x<0||this.x>w) this.vx*=-1; if(this.y<0||this.y>h) this.vy*=-1; }
      draw(){ ctx.beginPath(); ctx.arc(this.x,this.y,opts.radius,0,Math.PI*2); ctx.fillStyle=opts.color; ctx.fill(); }
      lines(){ particles.forEach(p=>{ const d=Math.hypot(this.x-p.x,this.y-p.y); if(d<opts.distance){ ctx.beginPath(); ctx.moveTo(this.x,this.y); ctx.lineTo(p.x,p.y); ctx.strokeStyle=`rgba(255,255,255,${1-d/opts.distance})`; ctx.stroke(); } }); }
    }
    function init(){ particles.length=0; for(let i=0;i<opts.count;i++) particles.push(new Particle()); }
    function animate(){ ctx.clearRect(0,0,w,h); particles.forEach(p=>{ p.update(); p.draw(); p.lines(); }); requestAnimationFrame(animate); }
    init(); animate();
  </script>

  <!-- ===== Loader header/footer + nav (priorité racine, fallback partials/) ===== -->
  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const headMount = document.getElementById("header");
    const footMount = document.getElementById("footer");
    if (!headMount && !footMount) return;

    const isGh = /github\.io$/.test(location.hostname);
    let base = "/";
    if (isGh) {
      const parts = location.pathname.split("/").filter(Boolean);
      base = parts.length ? `/${parts[0]}/` : "/";
    }

    const candidates = (p) => {
      const clean = p.replace(/^\//, "");
      return [ base + clean, "./" + clean, "../" + clean ];
    };

    async function fetchAny(paths) {
      const queue = paths.flatMap(candidates);
      for (const u of queue) {
        try { const r = await fetch(u, { cache: "no-cache" }); if (r.ok) return r.text(); } catch(_) {}
      }
      throw new Error("Aucun chemin valide parmi: " + paths.join(", "));
    }

    function fixRootUrls(container) {
      container.querySelectorAll('a[href^="/"], img[src^="/"], link[href^="/"], script[src^="/"]')
        .forEach(el => {
          const attr = el.hasAttribute("href") ? "href" : "src";
          const val = el.getAttribute(attr);
          if (/^\/\//.test(val)) return;
          el.setAttribute(attr, base + val.replace(/^\//, ""));
        });
    }

    // HEADER
    if (headMount) {
      fetchAny(["header.html", "partials/header.html"])
        .then(html => {
          headMount.innerHTML = html;
          fixRootUrls(headMount);
          return fetchAny(["assets/nav.js", "nav.js"]);
        })
        .then(code => {
          const s = document.createElement("script");
          if (/\b(import|export)\b/.test(code)) s.type = "module";
          s.textContent = code;
          document.body.appendChild(s);
          console.log("[awenoria] header + nav chargés");
        })
        .catch(err => {
          console.error("Header load error:", err);
          headMount.innerHTML = "<!-- Header introuvable -->";
        });
    }

    // FOOTER
    if (footMount) {
      fetchAny(["footer.html", "partials/footer.html"])
        .then(html => { footMount.innerHTML = html; fixRootUrls(footMount); })
        .catch(err => {
          console.error("Footer load error:", err);
          footMount.innerHTML = "<!-- Footer introuvable -->";
        });
    }
  });
  </script>

  <!-- ===== Intégration CMP “pro” si présente + fallback local ===== -->
  <script>
    (function(){
      // Détecte TCF v2 (__tcfapi) ou CMP générique (__cmp) si déjà chargée
      function hasTCF(){ return typeof window.__tcfapi === 'function'; }
      function hasCMP(){ return typeof window.__cmp === 'function'; }

      // Fallback minimal (localStorage) — ne dépose AUCUN cookie non essentiel
      const KEY = 'awenoria_consent';
      function readLocal(){ try{ return JSON.parse(localStorage.getItem(KEY)||'{}'); }catch(e){ return {}; } }
      function writeLocal(v){ try{ localStorage.setItem(KEY, JSON.stringify(v)); }catch(e){} }

      function acceptAll(){
        if(hasTCF()){
          try{ window.__tcfapi('displayConsentUi'); /* laisser l’UI gérer */ }catch(e){}
        }else if(hasCMP()){
          try{ window.__cmp('openSettings'); }catch(e){}
        }else{
          writeLocal({all:true, ts:Date.now()});
          document.dispatchEvent(new CustomEvent('awenoria:consentChange', {detail:{all:true}}));
          alert('Préférences enregistrées (version locale).');
        }
      }

      function refuseAll(){
        if(hasTCF()){
          try{ window.__tcfapi('displayConsentUi'); }catch(e){}
        }else if(hasCMP()){
          try{ window.__cmp('denyAll'); }catch(e){}
        }else{
          writeLocal({all:false, ts:Date.now()});
          document.dispatchEvent(new CustomEvent('awenoria:consentChange', {detail:{all:false}}));
          alert('Refus enregistré (version locale).');
        }
      }

      function customize(){
        if(hasTCF()){
          try{ window.__tcfapi('displayConsentUi'); }catch(e){ alert('Centre de préférences indisponible.'); }
        }else if(hasCMP()){
          try{ window.__cmp('openSettings'); }catch(e){ alert('Centre de préférences indisponible.'); }
        }else{
          alert('Centre de préférences non installé. Aucune activation de traceurs non essentiels sans votre accord.');
        }
      }

      document.querySelectorAll('[data-consent="accept_all"]').forEach(b=>b.addEventListener('click',acceptAll));
      document.querySelectorAll('[data-consent="refuse_all"]').forEach(b=>b.addEventListener('click',refuseAll));
      document.querySelectorAll('[data-consent="customize"]').forEach(b=>b.addEventListener('click',customize));

      // Expose (utile à d’autres scripts)
      window.awenoriaConsent = { read: readLocal };
    })();
  </script>
</body>
</html>
